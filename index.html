<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>speep.me</title>
  <link rel="icon" type="image/png" href="screamgnome.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; width: 100%; }

    :root{
      /* Scales across devices */
      --pad: clamp(10px, 2.2vmin, 16px);
      --gap: clamp(8px, 2vmin, 12px);

      /* Win95 window chrome heights (explicit so bottom always fits) */
      --title-h: clamp(28px, 4.2vmin, 36px);
      --menu-h:  clamp(26px, 3.8vmin, 32px);
      --status-h: clamp(26px, 3.8vmin, 32px);

      /* Sidebar width scales down on narrow screens */
      --sidebar-w: clamp(160px, 24vw, 220px);
    }

    body {
      background: linear-gradient(to bottom, #ffffff 0%, #ffffff 95%, #000000 100%);
      font-family: "Courier New", monospace;
      color: #000;
      overflow: hidden;  /* lock outer page scrolling */
      position: relative;
      padding-bottom: env(safe-area-inset-bottom, 0); /* avoid iOS bar overlay */
    }

    /* App frame: lock to safe viewport height on all devices */
    .site-container {
      position: absolute;
      inset: 20px;
      background: #fff;
      /* Prefer 100svh (safe), fall back to 100dvh (dynamic) */
      height: calc((100svh - 40px));
      height: calc((100dvh - 40px));
      border: 1px solid #000;
      box-shadow: 6px 6px 12px rgba(0,0,0,.2);
      display: grid;
      grid-template-columns: var(--sidebar-w) 1fr;
      z-index: 2;
    }

    /* ==== Sidebar ==== */
    .sidebar {
      background: #f3f3f3;
      border-right: 1px solid #000;
      display: grid;
      grid-template-rows: auto auto 1fr;
      padding: var(--pad);
      gap: var(--gap);
      min-width: 0;
    }

    .photo-frame {
      width: 100%;
      aspect-ratio: 1 / 1;
      background: #fff;
      border: 1px solid #000;
      box-shadow: inset -2px -2px 0 #000, inset 2px 2px 0 #fff;
      position: relative;
      overflow: hidden;
      display: grid;
      place-items: center;
    }
    #profile-pic {
      width: 100%; height: 100%;
      object-fit: cover; cursor: pointer;
      position: relative; z-index: 1;
      display: block;
      -webkit-user-drag: none;
      user-select: none;
    }
    #explosion {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      display: none; pointer-events: none;
      z-index: 2;
    }
    .screen-shake { animation: shake .25s linear 1; }
    @keyframes shake {
      0%,100%{ transform: translate(0,0); }
      25%{ transform: translate(2px,-2px); }
      50%{ transform: translate(-2px,2px); }
      75%{ transform: translate(2px,2px); }
    }

    .mini-caption {
      text-align: center;
      font-size: clamp(.85rem, 1.6vmin, .95rem);
      background: #fff;
      border: 1px solid #000;
      box-shadow: inset -1px -1px 0 #000, inset 1px 1px 0 #fff;
      padding: 8px 10px;
      transition: opacity .15s ease;
    }

    .btn-95 {
      display: block;
      text-decoration: none;
      color: #000;
      background: #e9e9e9;
      border: 1px solid #000;
      box-shadow: inset -2px -2px 0 #fff, inset 2px 2px 0 #000;
      padding: 10px 12px;
      text-align: left;
      transition: transform .05s ease;
      user-select: none;
      font-size: clamp(.9rem, 1.8vmin, 1rem);
    }
    .btn-95:active {
      transform: translate(1px,1px);
      box-shadow: inset -2px -2px 0 #000, inset 2px 2px 0 #fff;
      background: #dcdcdc;
    }
    .nav { display: grid; gap: 8px; align-content: start; }

    /* ==== Main ==== */
    .main {
      overflow: hidden; /* prevent outer scroll; inner body will scroll if needed */
      padding: clamp(10px, 2.2vmin, 24px);
      display: grid;
      place-items: center;
      min-width: 0;
      min-height: 0; /* IMPORTANT to allow child 100% height */
    }
    .win95-window {
      width: min(760px, 100%);
      background: #fff;
      border: 2px solid #000;
      box-shadow: inset -2px -2px 0 #000, inset 2px 2px 0 #fff;
      display: grid;
      /* Explicit row heights so bottom status bar is always visible */
      grid-template-rows: var(--title-h) var(--menu-h) 1fr var(--status-h);
      height: 100%;
      max-height: 100%;
      min-width: 0;
      min-height: 0; /* allow 1fr (body) to shrink */
    }
    .titlebar {
      background: #e0e0e0;
      border-bottom: 1px solid #000;
      padding: 0 10px;
      display: flex; justify-content: space-between; align-items: center;
      font-size: clamp(.95rem, 2vmin, 1rem);
    }
    .titlebar .title { font-weight: bold; }
    .controls { display: flex; gap: 6px; }
    .ctl {
      width: 18px; height: 18px;
      border: 1px solid #000;
      background: #fff;
      display: grid; place-items: center;
      font-size: 12px;
      line-height: 1;
    }
    .ctl:active { transform: translate(1px,1px); }

    .menubar {
      background: #f7f7f7;
      border-bottom: 1px solid #000;
      padding: 0 10px;
      display: flex; gap: 16px; align-items: center;
      font-size: clamp(.9rem, 1.8vmin, 1rem);
    }

    .window-body {
      padding: 16px;
      overflow: auto; /* inner scroll if content is tall */
      min-height: 0;  /* allow 1fr to actually shrink */
    }

    .intro {
      border: 1px solid #000;
      background: #fff;
      box-shadow: inset -1px -1px 0 #000, inset 1px 1px 0 #fff;
      padding: 14px;
    }
    .intro h1 { font-size: clamp(1.1rem, 2.6vmin, 1.35rem); margin-bottom: 8px; }
    .intro h4 {
      font-size: clamp(.95rem, 2.2vmin, 1rem);
      line-height: 1.6;
      letter-spacing: .3px;
      white-space: pre-wrap;
    }
    .intro a { color: blue; text-decoration: underline; }
    .intro a:hover { color: darkred; }

    /* ==== Status bar with centered counter ==== */
    .statusbar {
      background: #f7f7f7;
      border-top: 1px solid #000;
      padding: 0 10px;
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      font-size: clamp(.85rem, 1.8vmin, .95rem);
      gap: 12px;
    }
    .sb-left  { justify-self: start; }
    .sb-center{ justify-self: center; text-align: center; }
    .sb-right { justify-self: end; }

    /* Cursor shadow */
    .cursor-shadow {
      position: fixed;
      width: 18px; height: 18px;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><polygon points="0,0 0,32 8,24 14,30 16,28 10,22 18,22" fill="black"/></svg>') no-repeat center center;
      background-size: contain;
      opacity: .25; pointer-events: none; z-index: 10000;
    }

    /* ==== MULTI-GNOME RUNNERS ==== */
    .gnome-wrapper {
      position: fixed;
      bottom: 10px;
      left: 0;
      pointer-events: none;
      z-index: 9999;
      transform: translateX(-60px);
    }
    .gnome, .gnome-boom, .gnome-hitbox {
      user-select: none;
      -webkit-user-drag: none;
      -webkit-touch-callout: none;
    }
    .gnome {
      height: clamp(52px, 7.2vmin, 68px); /* scale down on short screens */
      transform: scaleX(1);
      pointer-events: auto;
      cursor: pointer;
    }
    .gnome-boom {
      position: absolute;
      left: -16px;
      bottom: -16px;
      width: 100px;
      display: none;
      pointer-events: none;
    }
    .gnome-hitbox {
      position: absolute;
      left: -10px;
      bottom: -6px;
      width: 88px;
      height: 80px;
      pointer-events: auto;
      cursor: pointer;
      background: transparent;
    }

    @keyframes gnome-run-left {
      0%   { transform: translateX(-60px); }
      100% { transform: translateX(calc(100vw + 60px)); }
    }
    @keyframes gnome-run-right {
      0%   { transform: translateX(calc(100vw + 60px)); }
      100% { transform: translateX(-60px); }
    }

    /* Extra compression for very short screens so the status bar never gets clipped */
    @media (max-height: 680px){
      :root{
        --title-h: 28px;
        --menu-h:  24px;
        --status-h: 24px;
      }
      .window-body{ padding: 12px; }
      .sidebar{ padding: 12px; gap: 8px; }
    }

    /* Narrow screens: slimmer sidebar */
    @media (max-width: 600px){
      :root{ --sidebar-w: clamp(140px, 30vw, 180px); }
    }
  </style>
</head>
<body>
  <div class="cursor-shadow" id="cursor-shadow"></div>

  <div class="site-container">
    <aside class="sidebar">
      <div class="photo-frame" id="photo-frame">
        <img src="Icons/icon1.png" alt="Profile or Logo" id="profile-pic" />
        <img src="Animations/explosion.gif" alt="Explosion" id="explosion" />
        <audio id="boom" src="Animations/explosion.mp3"></audio>
      </div>
      <div class="mini-caption" id="mini-caption">Writer, Editor, Reader</div>

      <nav class="nav">
        <a class="btn-95" href="index.html">Home</a>
        <a class="btn-95" href="about.html">About</a>
        <a class="btn-95" href="projects.html">Projects</a>
        <a class="btn-95" href="contact.html">Contact</a>
        <a class="btn-95" href="comic.html">DNGN</a>
      </nav>
    </aside>

    <main class="main">
      <section class="win95-window" role="group" aria-label="Welcome Window">
        <div class="titlebar">
          <div class="title">WELCOME.TXT</div>
          <div class="controls">
            <div class="ctl" title="Minimize">_</div>
            <div class="ctl" title="Maximize">□</div>
            <div class="ctl" title="Close">×</div>
          </div>
        </div>
        <div class="menubar"><div>File</div><div>Edit</div><div>View</div><div>Help</div></div>
        <div class="window-body">
          <div class="intro">
            <h1 class="shadow-text">Welcome. :^)</h1>
            <h4 class="shadow-text">
My name is Ian Abercrombie.
<br><br>I am a writer, editor, and reader.
<br><br>Originally from Florida, based in Newark, New Jersey.
<br><br>I have a Master of Fine Arts in Creative Writing from the University of Central Florida.
<br><br>My résumé, CV, and other employment related documents can be found on my "<a href="about.html">About</a>" page.
<br><br>To read examples of my work, visit "<a href="projects.html">Projects</a>."
<br><br>In order to catch me, visit my "<a href="contact.html">Contact</a>" page.
<br><br>If, instead, you want to learn to catch a gnome, visit "<a href="comic.html">DNGN</a>."
<br><br>Click my photo for more of me. I dare you.
            </h4>
          </div>
        </div>
        <div class="statusbar">
          <span class="sb-left">Ready</span>
          <span class="sb-center"><strong>GNOMES CAUGHT:</strong> <span id="gnome-count">0</span></span>
          <span class="sb-right">© 1998 SPEEP</span>
        </div>
      </section>
    </main>
  </div>

  <div id="gnome-layer"></div>

  <script>
    // === Speed range (seconds to cross the screen) ===
    const SPEED_MIN = 3.5;  // faster
    const SPEED_MAX = 9.0;  // slower
    const BATCH_MIN = 1;
    const BATCH_MAX = 7;
    const BATCH_DELAY_MIN = 5000;  // 5s
    const BATCH_DELAY_MAX = 15000; // 15s

    function rand(min, max){ return min + Math.random() * (max - min); }
    function randInt(min, max){ return Math.floor(rand(min, max + 1)); }
    function randDuration(min = SPEED_MIN, max = SPEED_MAX){ return rand(min, max); }

    // ==== Portrait rotation + caption mapping ====
    const images = ["Icons/icon1.png","Icons/icon2.png","Icons/icon3.png","Icons/icon4.png"];
    const titles = {
      "icon1.png": "Writer, Editor, Reader",
      "icon2.png": "Writer, Editor, Cyclops",
      "icon3.png": "Writer, Editor, Freak of Nature",
      "icon4.png": "Writer, Editor, Scallawag"
    };

    const pic = document.getElementById('profile-pic');
    const explosion = document.getElementById('explosion');
    const boom = document.getElementById('boom');
    const frame = document.getElementById('photo-frame');
    const miniCaption = document.getElementById('mini-caption');

    function filenameFromSrc(src) {
      return (src.split('/').pop() || "").split('?')[0].split('#')[0].toLowerCase();
    }
    function setCaptionForFilename(fileKey) {
      const text = titles[fileKey]; if (!text) return;
      miniCaption.style.opacity = '0';
      setTimeout(() => {
        miniCaption.textContent = text;
        miniCaption.style.opacity = '1';
      }, 80);
    }
    function initCaption() { setCaptionForFilename(filenameFromSrc(pic.src)); }
    if (pic.complete) initCaption(); else pic.addEventListener('load', initCaption, { once: true });

    function playExplosionOnFrame() {
      const base = explosion.getAttribute('src').split('?')[0];
      explosion.setAttribute('src', `${base}?t=${Date.now()}`);
      explosion.style.display = 'block';
    }
    function hideExplosionOnFrame() { explosion.style.display = 'none'; }

    pic.addEventListener('click', () => {
      playExplosionOnFrame();
      try { boom.volume = 0.4; boom.currentTime = 0; boom.play(); } catch {}
      frame.classList.add('screen-shake');

      setTimeout(() => {
        hideExplosionOnFrame();
        frame.classList.remove('screen-shake');
        const currentKey = filenameFromSrc(pic.src);
        let next;
        do { next = images[Math.floor(Math.random() * images.length)]; }
        while (filenameFromSrc(next) === currentKey);
        setCaptionForFilename(filenameFromSrc(next));
        pic.src = next;
      }, 300);
    });

    // ==== Wiggle wrapper ====
    function wrapWordsPreservingLinks(rootEl) {
      const walker = document.createTreeWalker(rootEl, NodeFilter.SHOW_TEXT, null);
      const nodes = [];
      while (walker.nextNode()) nodes.push(walker.currentNode);

      nodes.forEach(node => {
        if (node.parentElement && node.parentElement.closest('a')) return;
        const parts = node.nodeValue.split(/(\s+)/);
        const frag = document.createDocumentFragment();
        parts.forEach(part => {
          if (part.trim().length === 0) frag.appendChild(document.createTextNode(part));
          else {
            const span = document.createElement('span');
            span.className = 'shadow-word';
            span.textContent = part;
            frag.appendChild(span);
          }
        });
        node.parentNode.replaceChild(frag, node);
      });
    }
    document.querySelectorAll('h1.shadow-text, h4.shadow-text').forEach(wrapWordsPreservingLinks);

    // ==== Cursor shadow ====
    const cursorShadow = document.getElementById('cursor-shadow');
    document.addEventListener('mousemove', e => {
      cursorShadow.style.left = `${e.clientX + 3}px`;
      cursorShadow.style.top  = `${e.clientY + 3}px`;
    });

    // ==== Counter (CountAPI) ====
    const countEl = document.getElementById('gnome-count');
    const COUNT_NS = 'speep.me';
    const COUNT_KEY = 'gnomes_caught';
    const LOCAL_MIRROR = 'gnomeCountMirror';

    function setCount(n){ countEl.textContent = n; }

    async function initCount(){
      try {
        const r = await fetch(`https://api.countapi.xyz/get/${COUNT_NS}/${COUNT_KEY}`);
        const d = await r.json();
        if (typeof d.value === 'number') {
          setCount(d.value);
          localStorage.setItem(LOCAL_MIRROR, String(d.value));
          return;
        }
        throw new Error();
      } catch {
        const n = Number(localStorage.getItem(LOCAL_MIRROR) || 0);
        setCount(n);
      }
    }

    async function incrementCount(){
      try {
        const r = await fetch(`https://api.countapi.xyz/hit/${COUNT_NS}/${COUNT_KEY}`);
        const d = await r.json();
        if (typeof d.value === 'number') {
          setCount(d.value);
          localStorage.setItem(LOCAL_MIRROR, String(d.value));
          return;
        }
        throw new Error();
      } catch {
        const n = Number(localStorage.getItem(LOCAL_MIRROR) || 0) + 1;
        localStorage.setItem(LOCAL_MIRROR, String(n));
        setCount(n);
      }
    }

    initCount();

    // ==== MULTI-GNOME SPAWNER ====
    const gnomeLayer = document.getElementById('gnome-layer');

    function bindExplodeTarget(el, handler){
      ['pointerdown','mousedown','touchstart'].forEach(type => {
        el.addEventListener(type, (e) => {
          e.preventDefault();
          e.stopPropagation();
          handler();
        }, { passive: false });
      });
      el.addEventListener('dragstart', (e) => { e.preventDefault(); return false; });
    }

    function spawnGnome(side){
      const wrap = document.createElement('div');
      wrap.className = 'gnome-wrapper';

      const hit = document.createElement('div');
      hit.className = 'gnome-hitbox';

      const img = document.createElement('img');
      img.className = 'gnome';
      img.src = 'Animations/gnome.gif';
      img.alt = 'Running gnome';
      img.setAttribute('draggable','false');

      const boomImg = document.createElement('img');
      boomImg.className = 'gnome-boom';
      boomImg.src = 'Animations/explosion.gif';
      boomImg.alt = 'Boom';
      boomImg.setAttribute('draggable','false');

      // orientation: flip ONLY when coming from LEFT
      img.style.transform = (side === 'left') ? 'scaleX(-1)' : 'scaleX(1)';

      // start position offscreen
      wrap.style.animation = 'none';
      wrap.style.transform = (side === 'left')
        ? 'translateX(-60px)'
        : 'translateX(calc(100vw + 60px))';

      // attach to DOM
      wrap.appendChild(hit);
      wrap.appendChild(img);
      wrap.appendChild(boomImg);
      gnomeLayer.appendChild(wrap);

      let exploded = false;

      function explode(){
        if (exploded) return;
        exploded = true;

        // freeze current position
        const matrix = getComputedStyle(wrap).transform;
        wrap.style.animation = 'none';
        wrap.style.transform = matrix !== 'none' ? matrix : wrap.style.transform;

        // hide sprite, show explosion (cache-bust to replay)
        img.style.visibility = 'hidden';
        const base = boomImg.getAttribute('src').split('?')[0];
        boomImg.setAttribute('src', `${base}?t=${Date.now()}`);
        boomImg.style.display = 'block';

        // sound (independent instance so multiple booms can overlap)
        try {
          const a = new Audio(boom.src);
          a.volume = 0.5;
          a.play().catch(()=>{});
        } catch {}

        incrementCount();

        setTimeout(() => wrap.remove(), 750);
      }

      bindExplodeTarget(img, explode);
      bindExplodeTarget(hit, explode);

      // per-gnome speed
      const duration = randDuration(); // seconds

      requestAnimationFrame(() => {
        wrap.style.animation = (side === 'left' ? 'gnome-run-left' : 'gnome-run-right') + ` ${duration}s linear forwards`;
      });

      // remove after crossing if not exploded
      wrap.addEventListener('animationend', () => { if (!exploded) wrap.remove(); });
    }

    function spawnBatch(){
      const n = randInt(BATCH_MIN, BATCH_MAX);
      for (let i = 0; i < n; i++){
        const side = (Math.random() < 0.5) ? 'left' : 'right';
        const stagger = Math.random() * 400; // up to 0.4s spacing in a batch
        setTimeout(() => spawnGnome(side), stagger);
      }
    }

    function loopBatches(){
      const delay = rand(BATCH_DELAY_MIN, BATCH_DELAY_MAX);
      setTimeout(() => { spawnBatch(); loopBatches(); }, delay);
    }

    // Start
    setTimeout(() => { spawnBatch(); loopBatches(); }, rand(BATCH_DELAY_MIN, BATCH_DELAY_MAX));
  </script>
</body>
</html>
