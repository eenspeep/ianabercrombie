<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DNGN</title>
  <link rel="icon" type="image/png" href="screamgnome.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; width: 100%; }

    :root{
      --pad: clamp(10px, 2.2vmin, 16px);
      --gap: clamp(8px, 2vmin, 12px);
      --title-h: clamp(28px, 4.2vmin, 36px);
      --menu-h:  clamp(26px, 3.8vmin, 32px);
      --status-h: clamp(26px, 3.8vmin, 32px);
      --sidebar-w: clamp(160px, 24vw, 220px);

      --border: 1px solid #000;
      --shadow: 3px 3px 6px rgba(0,0,0,0.1);
      --bg: #fafafa;
      --panel-bg: #ccc;
      --blue95: #c3d7ff; /* win95 blue */
      --fg: #000;
      --muted: #666;
    }

    body{
      background: linear-gradient(to bottom, #ffffff 0%, #ffffff 95%, #000000 100%);
      font-family: "Courier New", monospace;
      color: var(--fg);
      overflow: hidden;
    }

    .site{
      display: grid;
      grid-template-columns: var(--sidebar-w) 1fr;
      grid-template-rows: auto 1fr auto;
      gap: var(--gap);
      padding: var(--pad);
      height: 100%;
      width: 100%;
    }

    .sidebar{
      grid-row: 1 / span 3;
      border: var(--border);
      background: #fff;
      padding: var(--pad);
      display: flex; flex-direction: column; gap: 8px;
      box-shadow: var(--shadow);
    }

    .sidebar .section{ font-weight:bold; margin-top: 8px; }

    .window{
      display: flex; flex-direction: column;
      border: var(--border);
      background: #fff;
      box-shadow: var(--shadow);
      min-width: 0;
    }
    .titlebar{
      height: var(--title-h);
      display: flex; align-items: center; gap: 8px;
      padding: 0 var(--pad);
      background: linear-gradient(180deg, #2165e3 0%, #1251c1 100%);
      color:#fff;
      border-bottom: var(--border);
    }
    .titlebar .dot{ width: 12px; height: 12px; background:#ff5f57; border:1px solid #000; border-radius:50%; }
    .titlebar h1{ font-size: clamp(16px, 3.2vmin, 22px); font-weight: 700; }

    .menubar{
      height: var(--menu-h);
      display: flex; align-items: center; gap: 12px;
      padding: 0 var(--pad);
      background: #eaeaea;
      border-bottom: var(--border);
      font-size: clamp(12px, 2.4vmin, 14px);
    }

    .window-body{
      display: grid; grid-template-columns: 1fr; grid-auto-rows: auto;
      padding: var(--pad);
      gap: var(--gap);
      min-height: 0;
      overflow: hidden;
      background: var(--bg);
    }

    /* -------- Comic container & pieces -------- */
    .comic-container{
      display:flex; flex-direction:column; align-items:center; gap: 10px;
      width:100%; height: 100%; min-height: 0; overflow:auto; padding-bottom: 4px;
    }

    /* Title above the panel (typewriter-capable). Overflow-safe now. */
    .comic-title {
      display: none; /* hidden by default */
      font-size: clamp(1.1rem, 2.6vmin, 1.3rem);
      font-weight: bold;
      font-family: "Courier New", monospace;
      color: #000;
      white-space: normal; overflow-wrap: anywhere; word-break: break-word; max-height: 10lh; overflow: auto;
      text-align: center;
      margin-bottom: 6px;
      max-width: 82%;
      padding: 6px 10px;
      background: #fff;
      border: 1px solid #000;
      box-shadow: inset -2px -2px 0 #000, inset 2px 2px 0 #fff;
    }

    /* Default single panel look (4:3) */
    .comic-panel {
      position: relative; z-index: 1;
      width: 82%; max-width: 720px;
      aspect-ratio: 4 / 3; /* 720x540 feel */
      background-color: var(--panel-bg);
      background-size: cover; background-position: center;
      border: 1px solid black;
      box-shadow: var(--shadow);
    }

    /* Container that can hold one or many panels */
    .panel-area{
      width: 100%;
      display: grid;
      grid-auto-rows: auto;
      gap: 16px;
      place-items: center;
    }

    /* Optional taller panel modifier classes */
    .comic-panel.tall-45{ aspect-ratio: 4 / 5; }
    .comic-panel.tall-23{ aspect-ratio: 2 / 3; }

    /* Multi-column layouts for multiple panels */
    .panel-area.columns-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .panel-area.columns-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }

    .panel-area.columns-2 .comic-panel,
    .panel-area.columns-3 .comic-panel{
      width: 100%;
      max-width: 720px;
    }

    /* Caption block — overflow-safe now */
    .comic-text {
      position: relative; z-index: 1; overflow-wrap: anywhere; word-break: break-word; max-height: 40vh; overflow: auto;
      font-size: clamp(1rem, 2.4vmin, 1.1rem);
      line-height: 1.6; letter-spacing: 0.5px;
      text-align: center; white-space: pre-wrap;
      border: 1px solid black; padding: 10px 15px; background: #f9f9f9;
      max-width: 82%;
      box-shadow: var(--shadow);
    }

    /* Win95-ish badge chip for title flair */
    .badge {
      display:inline-flex; align-items:center; gap:6px; padding: 2px 8px;
      font-size: 0.85em; border: 1px solid #000; background: #e5ecff; color:#000;
      box-shadow: inset -1px -1px 0 #000, inset 1px 1px 0 #fff;
      border-radius: 3px;
    }
    .badge .dot{ width:8px; height:8px; border-radius:50%; background:#f00; border:1px solid #000; }

    .btn-95{
      --btn-bg: #eaeaea; --btn-shadow: inset -2px -2px 0 #000, inset 2px 2px 0 #fff;
      border: 1px solid #000; padding: 6px 10px; background: var(--btn-bg);
      box-shadow: var(--btn-shadow); color:#000; text-decoration:none;
      display:inline-block; user-select:none;
    }
    .btn-95:active{ box-shadow: inset 2px 2px 0 #000, inset -2px -2px 0 #fff; }

    .button-bar{ display:flex; gap:8px; align-items:center; justify-content:center; }
    .button-bar input{ width: 90px; text-align:center; border:1px solid #000; padding:4px 6px; }

    /* Status bar */
    .statusbar{
      height: var(--status-h);
      border-top: var(--border);
      background: #f0f0f0;
      display: grid; grid-template-columns: 1fr 1fr; gap: 8px; align-items:center;
      padding: 0 var(--pad);
      font-size: clamp(12px, 2.3vmin, 14px);
    }

    /* Scrollbar polishing for the content pane */
    .comic-container::-webkit-scrollbar { width: 3px; background: transparent; }
    .comic-container::-webkit-scrollbar-thumb { background:#bbb; }
    .comic-container::-webkit-scrollbar-track { background: transparent; }

    /* Fun cursor shimmer for title cursor */
    .cursor{ display:inline-block; width: 0.6ch; }
    .cursor::after{ content:"▉"; }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      50.01%, 100% { opacity: 0; }
    }

    @keyframes shine {
      0% { background-position: 0 0; }
      100% { background-position: -200% 0; }
    }
    .shiny {
      display:inline-block;
      color: transparent;
      background: linear-gradient(90deg, currentColor 0 30%, #ffffff 50%, currentColor 70% 100%);
      background-size: 200% 100%;
      -webkit-background-clip: text;
      background-clip: text;
      animation: shine 2.2s linear infinite;
    }

    @media (prefers-reduced-motion: reduce) {
      .wiggle { animation: none !important; }
      .wavy .wchar { animation: none !important; }
      .cursor::after{ content:"|"; animation: none !important; }
    }
  </style>
</head>
<body>
  <div class="site">
    <aside class="sidebar">
      <div class="section">Navigation</div>
      <div class="sb-left">&nbsp;</div>
      <div class="section">About</div>
      <p style="color:var(--muted)">A Courier‑themed comic UI with Win95 vibes.</p>
    </aside>

    <main class="window">
      <div class="titlebar">
        <div class="dot" aria-hidden="true"></div>
        <h1>DNGN — Courier Comic</h1>
      </div>
      <div class="menubar"><div>File</div><div>Edit</div><div>View</div><div>Help</div></div>

      <div class="window-body">
        <div class="comic-container">
          <div class="comic-title" id="command-title"></div>
          <!-- MULTI‑PANEL‑READY AREA -->
          <div id="panel-area" class="panel-area"></div>
          <div class="comic-text" id="caption"></div>

          <div class="button-bar">
            <a id="first" href="#" class="btn-95">First</a>
            <a id="prev" href="#" class="btn-95">Previous</a>
            <input type="number" id="page-jump" min="1" placeholder="Page #" />
            <a id="next" href="#" class="btn-95">Next</a>
            <a id="latest" href="#" class="btn-95">Latest</a>
            <button id="save" class="btn-95">Save Page</button>
            <button id="load" class="btn-95">Load Page</button>
          </div>
        </div>
      </div>

      <div class="statusbar">
        <div class="sb-left">&nbsp;</div>
        <div style="text-align:right">© DNGN</div>
      </div>
    </main>
  </div>

  <script>
    /* ======== HELPER UTILS ======== */
    function clamp(v, lo, hi){ return Math.min(hi, Math.max(lo, v)); }

    /* ======== TYPEWRITER TITLE (optional) ======== */
    const BADGE_HTML = '<span class="badge" title="Courier status"><span class="dot"></span> COURIER</span>';
    let titleTimer = null;

    function setCommandTitle(page){
      const titleEl = document.getElementById('command-title');
      if (!titleEl) return;

      const t = titles[page];
      if (!t || !t.text){
        titleEl.style.display = 'none';
        titleEl.textContent = '';
        return;
      }

      // Show and type
      titleEl.style.display = '';
      titleEl.innerHTML = '';
      const text = t.text;
      let i = 0;
      const step = () => {
        if (i <= text.length){
          titleEl.innerHTML = text.slice(0, i) + '<span class="cursor"></span>' + (t.badge ? ' ' + BADGE_HTML : '');
          i++;
          titleTimer = setTimeout(step, 50);
        } else {
          titleEl.innerHTML = text + '<span class="cursor"></span>' + (t.badge ? ' ' + BADGE_HTML : '');
        }
      };
      step();
    }

    /* ======== COMIC PAGE LOGIC ======== */
    (function(){
      const totalPages = 37; // Update when adding comics

      const captions = {
        1: { text: `Before you stands a bridge into darkness. Across the bridge, the DNGN. Your journey begins here. Humble. Unencumbered. Fastidious. Forthright? Brave... wait a second. Who is that?` },
        2: { text: `Hold on. Why don't we move some things out of the way?` },
        3: { text: `Let's get this fellow situated, why don't we?` },
        4: { text: `I'm sorry. It seems I was woefully unprepared for guests. Especially humble, unencumbered, fastidious, forthright, brave guests. Guests such as yourself. Allow me to put things in their places for this fellow's introduction.` },
        5: { text: `This is <b>FTR.</b> <br> <b>FTR</b> has six <b>CORE STATISTICS</b>.` },
        6: { text: `Let's see some more information about <b>FTR</b> before we place his <b>CORE STATISTICS</b>.` },
        7: { text: `If you just. Yeah. Just. Right there. That looks good.` },
        8: { text: `Ah, memories.` },
        9: { text: `Our <b>CORE STATISTICS</b> are now prepared.` },
        10:{ text: `And now, this bridge.` },
        11:{ text: `Let's remind ourselves of the <b>CORE STATISTICS</b>.` },
        12:{ text: `Perhaps we can stand to remember more.` },
        13:{ text: `A Gnome.` },
        14:{ text: `A <b>GNOME</b>.` },
        15:{ text: `This <b>GNOME</b> will be with us. I cannot rid myself of him.` },
        16:{ text: `But I can try.` },
        17:{ text: `Oh.` },
        18:{ text: `What a terrible sound.` },
        19:{ text: `Well, then.` },
        20:{ text: `Let's get on with it.` },
        21:{ text: `Beyond this bridge is the DNGN.` },
        22:{ text: `We have much to do.` },
        23:{ text: `We've crossed the bridge.` },
        24:{ text: `Within the DNGN, we find the first Hallway.` },
        25:{ text: `We have much to do.` },
        26:{ text: `It seems that I am becoming anxious.` },
        27:{ text: `I hope that doesn't continue.` },
        28:{ text: `Shall we move on?` },
        29:{ text: `We should move on.` },
        30:{ text: `We must move on.` },
        31:{ text: `If we keep walking this way, we will arrive somewhere.` },
        32:{ text: `It seems we have arrived somewhere.` },
        33:{ text: `What should we do?` },
        34:{ text: `A decision.` },
        35:{ text: `<i>Fine. We'll take the sword. It is foolish. But perhaps foolishness is the best we can manage, finally.</i>`, title: `>FTR: FOCUS ON THE TASK AT HAND`},
        36:{ text: `<b>FTR</b> is trying to pull the RUSTY SWORD out, but it's stuck!`},
        37:{ text: `<b>FTR</b> is probably saying, like, "hrrggghhhhhhhffffffffffffffrrrrrrffgggggggggfhhhh" oh look he got it!`}
      };

      const titles = {
        35: { text: `>FTR: FOCUS ON THE TASK AT HAND`, badge: true }
      };

      const IMAGE_EXTENSIONS = ["png", "jpg", "jpeg", "webp", "gif"];
      const IMAGE_DIR = "Comics";
      const FALLBACK_COLOR = "#fff";

      /* ===== Page layout config =====
         For any page, you can control columns and panels.
         - columns: 1 (default), 2, 3
         - panels: array for each panel: { suffix?: 'a'|'b'|'c', tall?: '45'|'23' }
         Any page not listed renders one default 4:3 panel.
      */
      const pageLayout = {
        // examples; customize per page as needed:
        // 12: { columns: 2, panels: [{ suffix: 'a' }, { suffix: 'b' }] },
        // 18: { columns: 1, panels: [{ tall: '45' }] },
        // 24: { columns: 3, panels: [{ suffix: 'a' }, { suffix: 'b' }, { suffix: 'c' }] }
      };

      function renderPanels(page){
        const area = document.getElementById('panel-area');
        if (!area) return;
        area.innerHTML = '';

        const cfg = pageLayout[page] || { columns: 1, panels: [{}] };
        const cols = Math.max(1, Number(cfg.columns || 1));
        area.classList.toggle('columns-2', cols === 2);
        area.classList.toggle('columns-3', cols === 3);

        const panels = Array.isArray(cfg.panels) && cfg.panels.length ? cfg.panels : [{}];

        panels.forEach((p) => {
          const panelEl = document.createElement('div');
          panelEl.className = 'comic-panel';
          if (p.tall === '45') panelEl.classList.add('tall-45');
          if (p.tall === '23') panelEl.classList.add('tall-23');

          const pageStr = String(page).padStart(2, '0');
          const suffix = p.suffix ? String(p.suffix) : '';
          let loaded = false;

          IMAGE_EXTENSIONS.forEach(ext => {
            const img = new Image();
            const path = `${IMAGE_DIR}/page${pageStr}${suffix}.${ext}`;
            img.onload = () => {
              if (!loaded) {
                loaded = true;
                panelEl.style.backgroundImage = `url("${path}")`;
              }
            };
            img.src = path;
          });

          setTimeout(() => {
            if (!loaded) {
              console.warn('No image found for page', page, 'panel', suffix || '(default)');
              panelEl.style.backgroundImage = 'none';
              panelEl.style.backgroundColor = FALLBACK_COLOR;
            }
          }, 400);

          area.appendChild(panelEl);
        });
      }

      function getPageFromURL() {
        const m = window.location.search.match(/[?&]page=(\d+)/);
        return m ? parseInt(m[1], 10) : 1;
      }

      function savePage(page){ localStorage.setItem('dngn_page', String(page)); }
      function loadSavedPage(){ return parseInt(localStorage.getItem('dngn_page') || '1', 10); }

      function setCaption(page){
        const el = document.getElementById('caption');
        const c = captions[page];
        if (!el) return;
        el.innerHTML = c ? (c.text || '') : '';
      }

      function bindNavigation(page) {
        const byId = (id) => document.getElementById(id);
        const first = byId("first");
        const prev  = byId("prev");
        const next  = byId("next");
        const latest= byId("latest");
        const jump  = byId("page-jump");

        if (first) first.onclick = (e)=>{ e.preventDefault(); window.location.search = '?page=1'; };
        if (prev)  prev.onclick  = (e)=>{ e.preventDefault(); const p = clamp(page - 1, 1, totalPages); window.location.search = `?page=${p}`; };
        if (next)  next.onclick  = (e)=>{ e.preventDefault(); const p = clamp(page + 1, 1, totalPages); window.location.search = `?page=${p}`; };
        if (latest)latest.onclick= (e)=>{ e.preventDefault(); window.location.search = `?page=${totalPages}`; };

        if (jump){
          jump.value = String(page);
          jump.onkeydown = (ev)=>{
            if (ev.key === 'Enter'){
              const p = clamp(parseInt(jump.value || '1', 10), 1, totalPages);
              window.location.search = `?page=${p}`;
            }
          };
        }

        const saveBtn = document.getElementById('save');
        const loadBtn = document.getElementById('load');
        if (saveBtn) saveBtn.onclick = ()=>{ savePage(page); alert(`Saved page ${page}`); };
        if (loadBtn) loadBtn.onclick = ()=>{
          const p = clamp(loadSavedPage(), 1, totalPages);
          window.location.search = `?page=${p}`;
        };
      }

      function renderPage() {
        const currentPage = getPageFromURL();
        setCommandTitle(currentPage);
        setCaption(currentPage);
        renderPanels(currentPage); // << replaces single-image loader
        bindNavigation(currentPage);
        const sbLeft = document.querySelector('.sb-left');
        if (sbLeft) sbLeft.textContent = `Viewing page ${currentPage} of ${totalPages}`;
      }

      document.addEventListener('DOMContentLoaded', () => {
        try {
          renderPage();
        } catch (err) {
          console.error("Fatal script error:", err);
          alert("A script error occurred. Open DevTools (F12) → Console for details.");
        }
      });
    })();
  </script>

  <!-- Gnome CSS/JS could live below if needed; omitted here for brevity -->
</body>
</html>